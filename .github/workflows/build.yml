# Check there for the free amount we have https://help.github.com/en/github/setting-up-and-managing-billing-and-payments-on-github/about-billing-for-github-actions
# Check there for doc https://help.github.com/en/actions/automating-your-workflow-with-github-actions/workflow-syntax-for-github-actions#on

name: Build

on:
  push:
    branches:
      - '*'

jobs:
  build:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [macos-latest,ubuntu-latest,windows-latest]
        python-version: [3.8]
    steps:
      # Check OS
      - name: Check OS
        run: |
          git --version
          echo "$SHELL"
          which bash
          bash -c 'echo hello from $SHELL'
          echo ''
          env | sort
      # Checkout repo
      - uses: actions/checkout@v2
        with:
          fetch-depth: 5
          submodules: false
      # Setup Mac
      - name: Setup Mac
        if: runner.os == 'macOS'
        run: bash ./scripts/setup_mac.sh -s | tee "$HOME/.bashrc.env"
      # Display Mac ~/.bashrc.env
      - name: Display Mac ~/.bashrc.env
        if: matrix.os == 'macos-latest'
        run: cat "$HOME/.bashrc.env"
      # Setup
      - name: Setup
        shell: bash
        run: |
          touch "$HOME/.bashrc.env"
          if [ "$RUNNER_OS" = "macOS" ]; then
            source "$HOME/.bashrc.env"
          fi
          bash ./scripts/setup.sh -s
          git lga20
      # Display ~/.bashrc
      - name: Display ~/.bashrc
        run: cat $HOME/.bashrc | nl -ba
      # Display ~/.gitconfig
      - name: Display ~/.gitconfig
        run: cat $HOME/.gitconfig | nl -ba
      # Quick git check
      # Runs on the system default shell
      - name: Quick git check
        env:
          # Ensure to source this for MAC to have exported PATH in bash (default shell)
          BASH_ENV: "$HOME/.bashrc.env"
        run: |
          git debugo
          git st
          git lga20
      # Check Git
      - name: Check Git
        shell: bash
        env:
          BASH_ENV: "$HOME/.bashrc.env"
        run: |
          git debugo
          bash ./tools/git/test_git.sh
